# gitc コマンド要件定義書

## 概要
Git リポジトリのブランチクリーンアップを自動化するCLIツール「gitc」を開発する。
現在のブランチをデフォルトブランチに切り替え、最新状態にプルし、不要なローカルブランチを削除する一連の処理を1コマンドで実行する。

## 機能要件

### 1. 基本機能
- **コマンド名**: `gitc`
- **実行内容**: 以下の処理を自動実行
  1. デフォルトブランチの自動検出
  2. デフォルトブランチへの切り替え
  3. リモートからの最新変更の取得（pull）
  4. 不要なローカルブランチの削除

### 2. デフォルトブランチ検出
- リモートリポジトリのデフォルトブランチを自動検出
- 検出方法の優先順位:
  1. `git symbolic-ref refs/remotes/origin/HEAD` の結果
  2. `main` ブランチの存在確認
  3. `master` ブランチの存在確認
  4. その他の一般的なデフォルトブランチ名（`develop`, `dev`など）

### 3. ブランチ削除対象
- **削除対象**: デフォルトブランチ以外のすべてのローカルブランチ
- **削除除外**: 
  - デフォルトブランチ
  - 現在チェックアウトしているブランチ（処理後はデフォルトブランチになるため実質的に同じ）

### 4. エラーハンドリング
- Gitリポジトリではないディレクトリで実行された場合のエラー処理
- リモートリポジトリにアクセスできない場合のエラー処理
- デフォルトブランチが検出できない場合のエラー処理
- プル処理でコンフリクトが発生した場合のエラー処理
- ブランチ削除でエラーが発生した場合の処理継続

## 技術要件

### 1. 開発言語・フレームワーク
- **言語**: Go
- **CLIフレームワーク**: Cobra

### 2. 外部依存
- Gitコマンドの実行環境が必要
- インターネット接続（リモートリポジトリへのアクセス用）

### 3. 動作環境
- Linux, macOS, Windows対応
- Go 1.19以上

## 非機能要件

### 1. ユーザビリティ
- 実行前に削除予定のブランチ一覧を表示
- 確認プロンプトの表示（オプションでスキップ可能）
- 進行状況の表示
- 処理結果のサマリー表示

### 2. セキュリティ
- 誤操作防止のための確認機能
- 重要なブランチの保護機能（設定可能）

### 3. 保守性
- 詳細なログ出力機能
- デバッグモードの提供
- 設定ファイルによるカスタマイズ対応

## コマンドオプション

### 基本オプション
- `-y, --yes`: 確認プロンプトをスキップ
- `-v, --verbose`: 詳細な実行ログを表示
- `--dry-run`: 実際の処理は行わず、実行予定の内容のみ表示
- `--help`: ヘルプ表示

### 高度なオプション
- `--default-branch <branch>`: デフォルトブランチを手動指定
- `--exclude <pattern>`: 削除から除外するブランチのパターン指定
- `--no-pull`: プル処理をスキップ
- `--force`: 強制実行（マージされていないブランチも削除）

## 実行例

```bash
# 基本実行
$ gitc

# 確認なしで実行
$ gitc -y

# ドライラン
$ gitc --dry-run

# 詳細ログ付きで実行
$ gitc -v

# 特定ブランチを除外して実行
$ gitc --exclude "feature/*" --exclude "hotfix/*"
```

## 期待される出力例

```
🔍 Detecting default branch...
✅ Default branch detected: main

📋 Branches to be deleted:
  - feature/user-auth
  - bugfix/login-issue
  - experimental/new-ui

❓ Do you want to continue? [y/N]: y

🔄 Switching to main branch...
⬇️  Pulling latest changes...
🗑️  Deleting local branches...
  ✅ Deleted: feature/user-auth
  ✅ Deleted: bugfix/login-issue
  ✅ Deleted: experimental/new-ui

🎉 Cleanup completed! Deleted 3 branches.
```

## 配布方法
- GitHub Releasesでバイナリ配布
- Go modulesとしてインストール可能
- Homebrewでのインストール対応（将来的に）

---

# Claude Code 開発タスクリスト

## Phase 1: プロジェクト基盤構築 🏗️

### 環境セットアップ
- [x] Go モジュール初期化（`go mod init github.com/sunakan/gitc`）
- [x] Cobra CLI依存関係追加
- [x] 基本ディレクトリ構造作成
- [x] .gitignore ファイル作成（Go + Claude Code用）
- [x] README.md 基本構造作成

### プロジェクト構造
```
gitc/
├── cmd/
│   └── root.go          # Cobra ルートコマンド
├── internal/
│   ├── git/            # Git操作ロジック
│   ├── ui/             # ユーザーインターフェース
│   └── config/         # 設定管理
├── main.go             # エントリーポイント
├── go.mod
├── go.sum
└── CLAUDE.md           # このファイル
```

## Phase 2: コア機能実装 ⚡

### Git操作の基盤
- [x] Git リポジトリ検証機能
- [x] Git コマンド実行ヘルパー関数
- [x] エラーハンドリング基盤

### デフォルトブランチ検出
- [x] `git symbolic-ref refs/remotes/origin/HEAD` 実行機能
- [x] フォールバック検出ロジック（main/master/develop/dev）
- [x] ブランチ存在確認機能
- [x] デフォルトブランチ検出の統合機能

### ブランチ操作
- [x] 現在のブランチ取得機能
- [x] ローカルブランチ一覧取得機能
- [x] ブランチ切り替え機能
- [x] ブランチ削除機能

### リモート操作
- [x] git pull 実行機能
- [x] リモートアクセス確認機能
- [x] コンフリクト検出とエラーハンドリング

## Phase 3: CLI インターフェース 🖥️

### Cobra コマンド構造
- [ ] ルートコマンド実装
- [ ] フラグ定義（--yes, --verbose, --dry-run等）
- [ ] ヘルプメッセージ設定
- [ ] バリデーション機能

### ユーザーインターフェース
- [ ] 進行状況表示機能（絵文字付き）
- [ ] 確認プロンプト実装
- [ ] ブランチ一覧表示機能
- [ ] エラーメッセージ表示機能
- [ ] 成功メッセージとサマリー表示

## Phase 4: 高度な機能 🚀

### オプション機能実装
- [ ] `--dry-run` モード実装
- [ ] `--verbose` 詳細ログ機能
- [ ] `--default-branch` 手動指定機能
- [ ] `--exclude` パターン除外機能
- [ ] `--no-pull` プルスキップ機能
- [ ] `--force` 強制実行機能

### 設定・カスタマイズ
- [ ] 設定ファイル読み込み機能
- [ ] 除外パターン設定
- [ ] デフォルト設定管理

## Phase 5: エラーハンドリング・安全性 🛡️

### エラーケース対応
- [ ] 非Gitディレクトリでの実行エラー
- [ ] リモートアクセス不可エラー
- [ ] デフォルトブランチ検出失敗エラー
- [ ] プルコンフリクトエラー
- [ ] ブランチ削除失敗時の継続処理

### 安全性機能
- [ ] 重要ブランチ保護機能
- [ ] 未マージブランチ警告
- [ ] 確認プロンプト強化

## Phase 6: テスト・品質保証 🧪

### テスト実装
- [ ] ユニットテスト（Git操作）
- [ ] インテグレーションテスト
- [ ] エラーケースのテスト
- [ ] CLI オプションのテスト

### 品質向上
- [ ] コードレビュー
- [ ] リファクタリング
- [ ] パフォーマンス最適化
- [ ] ドキュメント整備

## Phase 7: 配布・デプロイ 📦

### ビルド・配布
- [ ] クロスプラットフォームビルド設定
- [ ] バイナリ最適化
- [ ] GitHub Actions CI/CD設定
- [ ] リリースプロセス自動化

### ドキュメント
- [ ] README.md 完成版
- [ ] インストール手順
- [ ] 使用例とチュートリアル
- [ ] トラブルシューティングガイド

---

## 開発ガイドライン

### コーディング規約
- Go の標準的な命名規則に従う
- エラーハンドリングは必須
- 関数は単一責任の原則に従う
- 適切なコメントを追加

### Git ワークフロー
- 機能ごとにブランチを作成
- 小さなコミットを心がける
- コミットメッセージは分かりやすく

### 優先順位
1. **Phase 1-2**: 基本機能を最優先で実装
2. **Phase 3**: ユーザビリティを重視
3. **Phase 4**: 高度な機能は後回し可能
4. **Phase 5-7**: 品質と安定性の確保

## 次のアクション
Phase 1 から順番に開始し、各フェーズ完了後に動作確認を行う。
